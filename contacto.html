<!DOCTYPE html>
<html>
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" integrity="sha256-h20CPZ0QyXlBuAw7A+KluUYx/3pK+c7lYEpqLTlxjYQ=" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <link rel="stylesheet" href="styles.css">
  <title>Escena compañia de arte y teatro</title>
  </head>
  <body>
	<main>
		<section class="container-fluid">
        <div class="logo-header">
            <img src="https://res.cloudinary.com/dw9docv2h/image/upload/v1587604752/logo_P%C3%A1gina_ESCENA-05_yd1p4l.png" height="81" width="151" alt="Logo de escena">
        </div>
        <header class="header">
            <nav class="navbar navbar-expand-lg navbar-light bg-light">
              <a class="navbar-brand"></a>
              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
            
              <div class="collapse navbar-collapse" id="navbarSupportedContent"> 
                <ul class="navbar-nav m-auto">
                  <li class="nav-item active">
                    <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">Link</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">Link</a>
                  </li>
                </ul>
              </div>
            </nav>
          </header>
		</section>
		<section class="section section-contacto">
        <div class="row container-fluid contacto-form" id="app">
            <div class="col-sm-4 d-flex flex-column contact">
                <div class="form-group">
                    <input id="nombre" name="nombre" autocomplete="off" class="form-control" v-validate="'required'" v-model="from_name" type="text" placeholder="Nombre completo" />
                </div>
                <div class="form-group">
                    <input id="asunto" name="asunto" autocomplete="off" class="form-control" v-validate="'required'" v-model="subject" type="text" placeholder="Asunto" />
                </div>
                <div class="form-group">
                    <input id="correo" name="correo" autocomplete="off" class="form-control" v-validate="'required|email'" v-model="from_email" type="email" placeholder="Correo electrónico" />
                </div>
                <div class="form-group">
                    <textarea id="mensaje" class="form-control" v-validate="'required|prohibirPalabras:mierda,malditos,maldita,puta,matar,coño,chupar,chupalo,mamalo,mamar'" placeholder="Mensaje" v-model="message" name="mensaje" cols="20" rows="5"></textarea>
                </div>
                <div v-show="errors.all().length" class="alert alert-danger">
                    <ul>
                        <li v-for="(error, i) in errors.all()">{{error}}</li>
                    </ul>
                </div>
                <button class="btn btn-success mb-5" @click="intentarEnviar">Enviar</button>
            </div>
            <div class="flex-column contacto">
                <h1 class="center contactanos-titulo">Contáctanos</h1>
                   <p>
                      Nos encantaría saber tu opinión
                   </p>
            </div>
        </div>  
    </section>
    <section class="section footer">
        <div class="row">
            <div class="columns">
                <h3>Síguenos: </h3>
                <ul>
                    <li><a href="https://www.facebook.com/escenaarteyteatro/" target="_blank"><i class="rrss fab fa-facebook-square fa-3x"></i></a></li>
                    <li><a href="https://api.whatsapp.com/send?phone=593959934473&text=&source=&data=&app_absent=" target="_blank"><i class="rrss fab fa-whatsapp fa-3x"></i></a></li>
                    <li><a href="https://instagram.com/escenaarteyteatro?igshid=19bx6ibnhsh22" target="_blank"><i class="rrss fab fa-instagram fa-3x"></i></a></li>
                </ul>
            </div>
            <div class="columns">
                <img class="center img-center" src="https://res.cloudinary.com/dw9docv2h/image/upload/v1587604752/logo_P%C3%A1gina_ESCENA-05_yd1p4l.png" height="81" width="151" alt="Logo de escena">
            </div>
            <div class="columns">
                <h3>Dirección</h3>
                <h5 style="text-align: justify">
                    <i class="fas fa-map-marker-alt fa-1x"></i>
                    Donec id lorem a justo ultricies malesuada. Aenean commodo sit amet metus gravida molestie.
                </h5>
            </div>
        </div>
        <div class="row">
            <h6 class="center">
                Copyright<i class="far fa-copyright"></i> ESCENA Compañía de arte y teatro. 2020.
            </h6>
        </div>
    </section>
	</main>
	<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.11/vue.min.js" integrity="sha256-ngFW3UnAN0Tnm76mDuu7uUtYEcG3G5H1+zioJw3t+68=" crossorigin="anonymous"></script>
    <script src="https://cdn.rawgit.com/twbs/bootstrap/v4-dev/dist/js/bootstrap.bundle.js"></script>
    <script src="https://cdn.emailjs.com/dist/email.min.js" type="text/javascript"></script>
    <script src="https://unpkg.com/vee-validate@2.2.9/dist/vee-validate.js"></script>
    <script src="https://unpkg.com/vee-validate@2.2.9/dist/locale/es.js"></script>
    <script>
    (function(){
        emailjs.init("user_dyP5KRs4t0ZT4EAxKWqtz");
    })();
        
    Vue.use(VeeValidate, {
        classes: true,// Sí queremos que ponga clases automáticamente
        // Indicar qué clase poner al input en caso de que sea
        // válido o inválido. Usamos Bootstrap 4
        classNames: {
            valid: "is-valid",
            invalid: "is-invalid",
        },
        // Podría ser blur, change, etcétera. Si está vacío
        // entonces se tiene que validar manualmente
        events: "change|blur|keyup",
    });
    VeeValidate.Validator.localize("es");
    VeeValidate.Validator.extend('prohibirPalabras', {
        getMessage: (campo, argumentos) => {
            // argumentos es un arreglo
            // return "El campo " + campo + " no puede contener las siguientes palabras: " + argumentos.join(" ");
            return "El campo " + campo + " no puede contener groserias, insultos o improperios.";
        },
        validate: (valor, argumentos) => {
            return argumentos.every(argumento => !valor.includes(argumento))
        },
    })

    new Vue({
                    el: '#app',
                    data(){
                        return {
                            from_name: '',
                            from_email: '',
                            message: '',
                            subject: '',
                        }
                    },
        methods: {
                    async intentarEnviar() {
                        let data = {
                            from_name: this.from_name,
                            from_email: this.from_email,
                            message: this.message,
                            subject: this.subject,
                        };

                        let isValidForm = await this.$validator.validate().then(esValido => esValido);
                        if (isValidForm) this.enviarMail(data);
                    },
                    async enviarMail(item) {
                        let sendEmail = await emailjs.send("daniel_rivas", "form_contact", item)
                            .then(function (response) {
                                if (response.text === 'OK') {
                                    alert('El comentario se ha enviado de forma exitosa');
                                }
                                console.log(`SUCCESS STATUS:${response.status} TEXT:${response.status}`)
                                return true;
                            }, function (err) {
                                alert('Ocurrió un problema al enviar el comentario');
                                console.log("FAILED. error=", err);
                                return false;
                            });

                        if (sendEmail) await this.limpiar();
                    },
                    async limpiar() {
                        await this.$validator.reset(); 
                        this.from_name = null;
                        this.from_email = null;
                        this.message = null;
                        this.subject = null;
                    }
                }
    });
    </script>
  </body>
